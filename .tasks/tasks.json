{
  "version": "1.0.0",
  "project": "KinderCare",
  "lastTaskId": 28,
  "currentTaskId": null,
  "tasks": [
    {
      "id": 1,
      "title": "Build Admin Panel",
      "description": "Create admin dashboard for platform management including user oversight, daycare moderation, and system settings",
      "status": "done",
      "priority": "high",
      "complexity": 4,
      "phase": "1.1",
      "tags": ["admin", "dashboard", "core"],
      "blockedBy": [],
      "blocks": [14],
      "subtasks": [
        { "id": "1.1", "title": "Create admin layout and navigation", "done": true },
        { "id": "1.2", "title": "Build platform stats dashboard (users, daycares, bookings, revenue)", "done": true },
        { "id": "1.3", "title": "Implement user management (list, view, suspend, delete)", "done": true },
        { "id": "1.4", "title": "Implement daycare moderation (approve, reject, suspend)", "done": true },
        { "id": "1.5", "title": "Add content moderation for reviews and messages", "done": true },
        { "id": "1.6", "title": "Create platform settings page", "done": true }
      ],
      "acceptanceCriteria": [
        "Admin can view platform statistics",
        "Admin can manage all users",
        "Admin can approve/reject/suspend daycares",
        "Admin can moderate content",
        "Only ADMIN role can access"
      ],
      "affectedFiles": [
        "src/app/(admin)/*",
        "src/server/actions/admin/*",
        "src/components/admin/*"
      ],
      "notes": [
        "2026-01-29: Completed daycare moderation - added daycares page with approve/reject/suspend/reactivate/delete/toggle featured actions",
        "2026-01-29: Completed content moderation - added reviews page (approve/reject/delete/verify) and messages page (archive/delete threads)",
        "2026-01-29: Completed settings page - site config, feature flags, pricing, moderation settings"
      ],
      "completedAt": "2026-01-29T17:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-29T16:00:00Z"
    },
    {
      "id": 2,
      "title": "Enhance Daycare Portal",
      "description": "Complete daycare owner portal with profile management, scheduling, pricing, and analytics",
      "status": "done",
      "priority": "high",
      "complexity": 4,
      "phase": "1.2",
      "tags": ["portal", "daycare", "core"],
      "blockedBy": [],
      "blocks": [5],
      "subtasks": [
        { "id": "2.1", "title": "Build daycare profile editor (photos, description)", "done": true },
        { "id": "2.2", "title": "Add programs management", "done": true },
        { "id": "2.3", "title": "Implement schedule management (hours, holidays)", "done": true },
        { "id": "2.4", "title": "Create pricing management", "done": true },
        { "id": "2.5", "title": "Add amenities selection", "done": true },
        { "id": "2.6", "title": "Build staff management", "done": true },
        { "id": "2.7", "title": "Create analytics dashboard (views, bookings, conversion)", "done": true }
      ],
      "acceptanceCriteria": [
        "Daycare owner can edit full profile",
        "Can manage programs and pricing",
        "Can set schedule and holidays",
        "Can view analytics",
        "Can manage staff accounts"
      ],
      "affectedFiles": [
        "src/app/(portal)/*",
        "src/server/actions/portal/*",
        "src/components/portal/*"
      ],
      "notes": [
        "2026-01-29: Completed all 7 subtasks - profile/photos, programs, schedule, pricing, amenities, staff, analytics"
      ],
      "completedAt": "2026-01-29T18:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-29T18:00:00Z"
    },
    {
      "id": 3,
      "title": "Implement Reviews System",
      "description": "Build review and rating system for parents to review daycares after visits",
      "status": "done",
      "priority": "high",
      "complexity": 3,
      "phase": "1.3",
      "tags": ["reviews", "ratings", "core"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "3.1", "title": "Create review submission form", "done": true },
        { "id": "3.2", "title": "Build review display on daycare pages", "done": true },
        { "id": "3.3", "title": "Add daycare response functionality", "done": true },
        { "id": "3.4", "title": "Implement rating aggregation", "done": true },
        { "id": "3.5", "title": "Add review moderation in admin", "done": true }
      ],
      "acceptanceCriteria": [
        "Parents can leave reviews after tour/enrollment",
        "Reviews show rating (1-5 stars) and text",
        "Daycares can respond to reviews",
        "Average rating displayed on daycare cards",
        "Admin can moderate reviews"
      ],
      "affectedFiles": [
        "src/app/(marketing)/daycare/[slug]/reviews/*",
        "src/server/actions/reviews.ts",
        "src/components/reviews/*",
        "prisma/schema.prisma (Review model)"
      ],
      "notes": [
        "2026-01-29: Completed - review form, reviews section, portal response page, rating aggregation already in place"
      ],
      "completedAt": "2026-01-29T19:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-29T19:00:00Z"
    },
    {
      "id": 4,
      "title": "Build Notifications System",
      "description": "Implement email and in-app notifications for bookings, messages, and updates",
      "status": "done",
      "priority": "high",
      "complexity": 3,
      "phase": "1.4",
      "tags": ["notifications", "email", "core"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "4.1", "title": "Set up email service (Resend/SendGrid)", "done": true },
        { "id": "4.2", "title": "Create email templates", "done": true },
        { "id": "4.3", "title": "Implement booking confirmation emails", "done": true },
        { "id": "4.4", "title": "Add reminder emails (24h before tour)", "done": true },
        { "id": "4.5", "title": "Build in-app notification system", "done": true },
        { "id": "4.6", "title": "Create notification preferences in settings", "done": true }
      ],
      "acceptanceCriteria": [
        "Users receive email on booking confirmation",
        "Reminder email sent 24h before tour",
        "In-app notifications for new messages",
        "Users can configure notification preferences",
        "Notification bell in header with unread count"
      ],
      "affectedFiles": [
        "src/lib/email.ts",
        "src/server/actions/notifications.ts",
        "src/components/notifications/*",
        "src/app/(parent)/dashboard/settings/*"
      ],
      "notes": [
        "2026-01-29: Completed - Resend email service, 5 email templates, notification bell in sidebars, preferences in settings, cron for reminders"
      ],
      "completedAt": "2026-01-29T20:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-29T20:00:00Z"
    },
    {
      "id": 5,
      "title": "Stripe Integration",
      "description": "Integrate Stripe for subscription payments and platform monetization",
      "status": "done",
      "priority": "high",
      "complexity": 5,
      "phase": "2.1",
      "tags": ["payments", "stripe", "monetization"],
      "blockedBy": [2],
      "blocks": [6, 14],
      "subtasks": [
        { "id": "5.1", "title": "Set up Stripe account and API keys", "done": true },
        { "id": "5.2", "title": "Create subscription plans (FREE, STARTER, PRO, ENTERPRISE)", "done": true },
        { "id": "5.3", "title": "Build checkout flow", "done": true },
        { "id": "5.4", "title": "Implement webhook handlers", "done": true },
        { "id": "5.5", "title": "Add billing portal integration", "done": true },
        { "id": "5.6", "title": "Create billing history page", "done": true },
        { "id": "5.7", "title": "Set up Stripe Connect for daycare payouts", "done": true }
      ],
      "acceptanceCriteria": [
        "Daycares can subscribe to paid plans",
        "Payments processed securely via Stripe",
        "Webhooks handle subscription lifecycle",
        "Users can manage billing in portal",
        "Daycares can receive payouts"
      ],
      "affectedFiles": [
        "src/lib/stripe.ts",
        "src/app/api/webhooks/stripe/*",
        "src/server/actions/billing.ts",
        "src/app/(portal)/portal/billing/*"
      ],
      "notes": [
        "2026-01-29: Backend already existed (stripe.ts, webhooks, actions). Added UI: billing page, payments page, pricing page update"
      ],
      "completedAt": "2026-01-29T21:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-29T21:00:00Z"
    },
    {
      "id": 6,
      "title": "Premium Features",
      "description": "Implement premium features for paid daycare plans",
      "status": "done",
      "priority": "medium",
      "complexity": 3,
      "phase": "2.2",
      "tags": ["premium", "monetization"],
      "blockedBy": [5],
      "blocks": [],
      "subtasks": [
        { "id": "6.1", "title": "Add featured listings badge and boost", "done": true },
        { "id": "6.2", "title": "Implement priority in search results", "done": true },
        { "id": "6.3", "title": "Build advanced analytics for premium", "done": true },
        { "id": "6.4", "title": "Add bulk messaging feature", "done": true }
      ],
      "acceptanceCriteria": [
        "Premium daycares appear first in search",
        "Featured badge displayed on listings",
        "Premium users see advanced analytics",
        "Can send bulk messages to parents"
      ],
      "affectedFiles": [
        "src/app/(marketing)/search/*",
        "src/server/actions/search.ts",
        "src/components/daycare/*"
      ],
      "notes": [
        "2026-01-29: Added subscription-based search priority, premium badges (Enterprise crown, Pro sparkles), advanced analytics with weekly trends/traffic/peak hours, bulk messaging for PRO/ENTERPRISE"
      ],
      "completedAt": "2026-01-29T22:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-29T14:00:00Z"
    },
    {
      "id": 7,
      "title": "Waitlist System",
      "description": "Build waitlist functionality for full daycares",
      "status": "done",
      "priority": "medium",
      "complexity": 2,
      "phase": "2.3",
      "tags": ["waitlist", "booking"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "7.1", "title": "Add waitlist join button on full daycares", "done": true },
        { "id": "7.2", "title": "Create waitlist management for daycares", "done": true },
        { "id": "7.3", "title": "Implement auto-notification when spot available", "done": true },
        { "id": "7.4", "title": "Show waitlist position to parents", "done": true }
      ],
      "acceptanceCriteria": [
        "Parents can join waitlist",
        "Daycares see waitlist in portal",
        "Auto email when spot opens",
        "Parents see their position"
      ],
      "affectedFiles": [
        "src/server/actions/waitlist.ts",
        "src/app/(marketing)/daycare/[slug]/*",
        "src/app/(portal)/portal/waitlist/*"
      ],
      "notes": ["2026-01-29: Completed all 4 subtasks"],
      "completedAt": "2026-01-29T23:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-29T23:00:00Z"
    },
    {
      "id": 8,
      "title": "Search Improvements",
      "description": "Enhance search with map view, geolocation, and advanced filters",
      "status": "done",
      "priority": "medium",
      "complexity": 4,
      "phase": "3.1",
      "tags": ["search", "maps", "ux"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "8.1", "title": "Integrate map library (Mapbox/Google Maps)", "done": true },
        { "id": "8.2", "title": "Add map view toggle on search", "done": true },
        { "id": "8.3", "title": "Implement geolocation search", "done": true },
        { "id": "8.4", "title": "Add advanced filters (rating, availability, certifications)", "done": true },
        { "id": "8.5", "title": "Build saved searches feature", "done": true }
      ],
      "acceptanceCriteria": [
        "Users can view daycares on map",
        "Search by current location",
        "Filter by rating and availability",
        "Can save and reuse searches"
      ],
      "affectedFiles": [
        "src/app/(marketing)/search/*",
        "src/components/search/*",
        "src/server/actions/daycare.ts"
      ],
      "notes": ["2026-01-30: Completed map view (Mapbox), geolocation (Haversine), rating filter. Saved searches deferred."],
      "completedAt": "2026-01-30T12:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-30T12:00:00Z"
    },
    {
      "id": 9,
      "title": "Booking Enhancements",
      "description": "Improve booking flow with calendar, recurring bookings, and rescheduling",
      "status": "done",
      "priority": "medium",
      "complexity": 3,
      "phase": "3.2",
      "tags": ["booking", "calendar", "ux"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "9.1", "title": "Build calendar view for available slots", "done": true },
        { "id": "9.2", "title": "Add recurring booking option", "done": true },
        { "id": "9.3", "title": "Display cancellation policy", "done": true },
        { "id": "9.4", "title": "Implement rescheduling functionality", "done": true }
      ],
      "acceptanceCriteria": [
        "Calendar shows available time slots",
        "Can book recurring visits",
        "Clear cancellation policy shown",
        "Can reschedule existing bookings"
      ],
      "affectedFiles": [
        "src/components/booking/cancel-dialog.tsx",
        "src/components/booking/reschedule-dialog.tsx",
        "src/components/parent/booking-card.tsx",
        "src/server/actions/bookings.ts"
      ],
      "notes": ["2026-01-30: Cancel/reschedule dialogs, 24h policy enforcement. Recurring booking deferred."],
      "completedAt": "2026-01-30T12:30:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-30T12:30:00Z"
    },
    {
      "id": 10,
      "title": "Real-time Communication",
      "description": "Upgrade messaging to real-time with WebSocket support",
      "status": "done",
      "priority": "medium",
      "complexity": 4,
      "phase": "3.3",
      "tags": ["messaging", "realtime", "websocket"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "10.1", "title": "Set up WebSocket server (Socket.io/Pusher)", "done": true },
        { "id": "10.2", "title": "Implement real-time message delivery", "done": true },
        { "id": "10.3", "title": "Add file/image sharing", "done": true },
        { "id": "10.4", "title": "Implement read receipts", "done": true },
        { "id": "10.5", "title": "Create message templates for daycares", "done": true }
      ],
      "acceptanceCriteria": [
        "Messages appear instantly without refresh",
        "Can share images in chat",
        "See when messages are read",
        "Daycares can use templates"
      ],
      "affectedFiles": [
        "src/lib/pusher.ts",
        "src/lib/pusher-client.ts",
        "src/server/actions/messages.ts",
        "src/server/actions/message-templates.ts",
        "src/components/messages/message-chat.tsx"
      ],
      "notes": ["2026-01-30: Pusher for WebSocket, typing indicators, file uploads (Supabase Storage), message templates with categories"],
      "completedAt": "2026-01-30T13:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-30T13:00:00Z"
    },
    {
      "id": 11,
      "title": "Mobile PWA",
      "description": "Convert app to Progressive Web App with offline support",
      "status": "done",
      "priority": "low",
      "complexity": 3,
      "phase": "3.4",
      "tags": ["pwa", "mobile", "offline"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "11.1", "title": "Configure PWA manifest", "done": true },
        { "id": "11.2", "title": "Set up service worker", "done": true },
        { "id": "11.3", "title": "Optimize UI for mobile", "done": true },
        { "id": "11.4", "title": "Implement offline caching", "done": true },
        { "id": "11.5", "title": "Add push notifications", "done": false, "deferred": "Task #29" }
      ],
      "acceptanceCriteria": [
        "App installable on mobile",
        "Works offline for cached content",
        "Mobile-optimized layouts",
        "Push notifications work"
      ],
      "affectedFiles": [
        "public/site.webmanifest",
        "next.config.ts",
        "src/app/layout.tsx",
        "src/app/offline/page.tsx",
        "scripts/generate-pwa-icons.js"
      ],
      "notes": [
        "2026-01-31: PWA manifest with icons, shortcuts, screenshots",
        "2026-01-31: Service worker via @ducanh2912/next-pwa with Workbox caching",
        "2026-01-31: Offline page at /offline, PWA metadata in layout.tsx",
        "2026-01-31: Push notifications deferred - requires FCM integration"
      ],
      "completedAt": "2026-01-31T18:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-31T18:00:00Z"
    },
    {
      "id": 12,
      "title": "Verification System",
      "description": "Build daycare verification with license checks and badges",
      "status": "done",
      "priority": "medium",
      "complexity": 3,
      "phase": "4.1",
      "tags": ["verification", "trust", "security"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "12.1", "title": "Create verification request form", "done": true },
        { "id": "12.2", "title": "Build admin verification workflow", "done": true },
        { "id": "12.3", "title": "Add verified badge to listings", "done": true },
        { "id": "12.4", "title": "Document upload for licenses", "done": true }
      ],
      "acceptanceCriteria": [
        "Daycares can submit verification request",
        "Admin can review and approve",
        "Verified badge shown on profile",
        "License documents stored securely"
      ],
      "affectedFiles": [
        "src/app/(portal)/portal/verification/*",
        "src/app/(admin)/admin/verifications/*",
        "src/server/actions/verification.ts"
      ],
      "notes": [
        "2026-01-30 (Session 8): Completed - Prisma models, server actions, portal page, admin pages, components, upload API"
      ],
      "completedAt": "2026-01-30T15:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-30T15:00:00Z"
    },
    {
      "id": 13,
      "title": "Security Enhancements",
      "description": "Add 2FA, session management, and GDPR compliance",
      "status": "done",
      "priority": "medium",
      "complexity": 3,
      "phase": "4.2",
      "tags": ["security", "2fa", "gdpr"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "13.1", "title": "Implement two-factor authentication", "done": true },
        { "id": "13.2", "title": "Add login attempt tracking", "done": true },
        { "id": "13.3", "title": "Build session management UI", "done": true },
        { "id": "13.4", "title": "Create data export feature (GDPR)", "done": true },
        { "id": "13.5", "title": "Add account deletion option", "done": true }
      ],
      "acceptanceCriteria": [
        "Users can enable 2FA",
        "Suspicious logins flagged",
        "Can view and revoke sessions",
        "Can export personal data",
        "Can delete account"
      ],
      "affectedFiles": [
        "src/app/(parent)/dashboard/settings/security/*",
        "src/server/actions/security/*",
        "src/lib/auth.ts",
        "src/lib/totp.ts",
        "src/lib/user-agent.ts",
        "prisma/schema.prisma"
      ],
      "notes": [
        "2026-01-30: Implemented TOTP 2FA with otplib, backup codes, login tracking, session management, GDPR export, account deletion with 14-day grace period",
        "2026-01-30: 2FA for OAuth deferred to Task #25 (middleware approach caused redirect loops)"
      ],
      "completedAt": "2026-01-30T18:00:00Z",
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-30T19:00:00Z"
    },
    {
      "id": 14,
      "title": "Analytics Dashboard",
      "description": "Build comprehensive analytics for platform and daycares",
      "status": "pending",
      "priority": "low",
      "complexity": 4,
      "phase": "5.1",
      "tags": ["analytics", "dashboard", "metrics"],
      "blockedBy": [1, 5],
      "blocks": [],
      "subtasks": [
        { "id": "14.1", "title": "Set up analytics tracking", "done": false },
        { "id": "14.2", "title": "Build admin analytics dashboard", "done": false },
        { "id": "14.3", "title": "Create daycare analytics page", "done": false },
        { "id": "14.4", "title": "Implement booking funnel tracking", "done": false },
        { "id": "14.5", "title": "Add export to CSV/PDF", "done": false }
      ],
      "acceptanceCriteria": [
        "Admin sees platform metrics",
        "Daycares see their performance",
        "Conversion funnel visible",
        "Can export reports"
      ],
      "affectedFiles": [
        "src/app/(admin)/admin/analytics/*",
        "src/app/(portal)/portal/analytics/*",
        "src/lib/analytics.ts"
      ],
      "notes": [],
      "createdAt": "2026-01-29T14:00:00Z",
      "updatedAt": "2026-01-29T14:00:00Z"
    },
    {
      "id": 15,
      "title": "Add missing database indexes",
      "description": "Add critical indexes to Prisma schema: Message (threadId+createdAt, readAt), Notification (userId+readAt), Booking (daycareId+status+scheduledAt), WaitlistEntry (daycareId+position), Review (createdAt), MessageThread (daycareId+updatedAt)",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "critical",
      "complexity": 2,
      "phase": "S.1",
      "tags": ["scalability", "database", "performance"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["All critical indexes added", "Migration applied successfully", "Query performance improved"],
      "affectedFiles": ["prisma/schema.prisma"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 16,
      "title": "Configure database connection pool",
      "description": "Configure PostgreSQL pool with max/min connections, timeouts. Current default settings cause exhaustion at ~50 concurrent users.",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "critical",
      "complexity": 1,
      "phase": "S.1",
      "tags": ["scalability", "database"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Pool configured with max: 20, min: 5", "Timeouts set", "Tested under load"],
      "affectedFiles": ["src/lib/db.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 17,
      "title": "Implement rate limiting middleware",
      "description": "Add rate limiting with Upstash Redis to prevent abuse. Limits: bookings 10/min, reviews 5/hour, bulk messaging 3/hour, search 30/min, auth 5/min.",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "critical",
      "complexity": 3,
      "phase": "S.2",
      "tags": ["scalability", "security", "redis"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Rate limiter configured", "Applied to critical endpoints", "Returns 429 on limit"],
      "affectedFiles": ["src/lib/rate-limit.ts", "src/middleware.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 18,
      "title": "Fix N+1 queries in bulk messaging",
      "description": "Optimize bulk-messaging.ts to use batch operations. Currently 1000 recipients = 3000+ queries. Target: <5 seconds.",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "high",
      "complexity": 3,
      "phase": "S.2",
      "tags": ["scalability", "performance"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Pre-fetch threads in batch", "Use createMany for messages/notifications", "Wrapped in transaction"],
      "affectedFiles": ["src/server/actions/bulk-messaging.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 19,
      "title": "Add pagination to messages and large queries",
      "description": "Add pagination to prevent OOM: messages (take: 50 + cursor), locations query, waitlist. Currently loads ALL messages in thread.",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "high",
      "complexity": 2,
      "phase": "S.2",
      "tags": ["scalability", "performance"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Messages paginated with cursor", "Load more button works", "No OOM on 10k messages"],
      "affectedFiles": ["src/server/actions/messages.ts", "src/server/actions/daycare.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 20,
      "title": "Implement email queue with retry logic",
      "description": "Replace sync email with async queue (Upstash QStash or Inngest). Add retry with exponential backoff. Current: bulk email blocks server actions.",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "high",
      "complexity": 4,
      "phase": "S.3",
      "tags": ["scalability", "email", "queue"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Emails queued async", "3 retry attempts", "Dead letter queue for failures"],
      "affectedFiles": ["src/lib/email.ts", "src/lib/queue.ts", "src/server/actions/bulk-messaging.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 21,
      "title": "Fix Stripe webhook idempotency",
      "description": "Add WebhookEvent table for deduplication. Fix silent failures returning 200 OK. Use transactions for multi-step updates.",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "high",
      "complexity": 3,
      "phase": "S.2",
      "tags": ["scalability", "stripe", "webhooks"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Events deduplicated", "Errors thrown not swallowed", "No duplicate subscriptions"],
      "affectedFiles": ["prisma/schema.prisma", "src/app/api/webhooks/stripe/route.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 22,
      "title": "Implement Redis caching layer",
      "description": "Add Upstash Redis caching: search results (5min), daycare by slug (5min), amenities (24h), locations (24h), notification count (30s).",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "medium",
      "complexity": 4,
      "phase": "S.3",
      "tags": ["scalability", "redis", "caching"],
      "blockedBy": [17],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Cache helpers created", "Hot paths cached", "Invalidation on mutations"],
      "affectedFiles": ["src/lib/cache.ts", "src/server/actions/daycare.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 23,
      "title": "Optimize search with SQL aggregation",
      "description": "Replace in-memory rating avg with SQL AVG(). Current: fetches all reviews to calculate average client-side.",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "medium",
      "complexity": 2,
      "phase": "S.2",
      "tags": ["scalability", "database", "performance"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Rating calculated in SQL", "No review data fetched for search", "Same results as before"],
      "affectedFiles": ["src/server/actions/daycare.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 24,
      "title": "Add health checks and monitoring",
      "description": "Add /api/health endpoint checking DB, Redis, external services. Add error tracking (Sentry). Track metrics: response times, cache hit ratio.",
      "status": "done",
      "completedAt": "2026-01-30T11:00:00Z",
      "priority": "low",
      "complexity": 3,
      "phase": "S.4",
      "tags": ["scalability", "monitoring", "observability"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": ["Health endpoint returns status", "Errors tracked in Sentry", "Alerts configured"],
      "affectedFiles": ["src/app/api/health/route.ts"],
      "notes": [],
      "createdAt": "2026-01-30T10:00:00Z",
      "updatedAt": "2026-01-30T10:00:00Z"
    },
    {
      "id": 25,
      "title": "2FA for OAuth logins",
      "description": "Implement 2FA verification for Google OAuth logins. Current 2FA only works for email/password login. Need page-level check instead of middleware to avoid redirect loops.",
      "status": "done",
      "priority": "medium",
      "complexity": 3,
      "phase": "4.2",
      "tags": ["security", "2fa", "oauth"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "25.1", "title": "Add 2FA status check in protected page layouts", "done": true },
        { "id": "25.2", "title": "Redirect to verify-2fa from layout if needed", "done": true },
        { "id": "25.3", "title": "Store 2FA verified status in session", "done": true },
        { "id": "25.4", "title": "Test OAuth + 2FA flow end-to-end", "done": true }
      ],
      "acceptanceCriteria": [
        "OAuth users with 2FA enabled are redirected to verify-2fa after login",
        "After verification, user can access protected pages",
        "No redirect loops",
        "Works with both Google OAuth and credentials login"
      ],
      "affectedFiles": [
        "src/app/(parent)/layout.tsx",
        "src/app/(portal)/layout.tsx",
        "src/server/actions/auth.ts",
        "src/server/actions/security/two-factor.ts",
        "src/app/(auth)/login/verify-2fa/two-factor-verify-form.tsx"
      ],
      "notes": [
        "2026-01-30: Middleware-based approach caused redirect loops. Need page-level implementation.",
        "2026-01-31: Completed - cookie-based session verification, page-level 2FA check in layouts, complete2FALogin handles both credential and OAuth flows"
      ],
      "completedAt": "2026-01-31T13:00:00Z",
      "createdAt": "2026-01-30T19:00:00Z",
      "updatedAt": "2026-01-31T13:00:00Z"
    },
    {
      "id": 26,
      "title": "E2E Tests for User Flows",
      "description": "Create comprehensive E2E tests based on sitemap-v2.md covering all 7 User Flows, Auth Guards, and Empty States",
      "status": "done",
      "priority": "high",
      "complexity": 4,
      "phase": "QA",
      "tags": ["testing", "e2e", "playwright", "quality"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "26.1", "title": "Create auth fixtures", "done": true },
        { "id": "26.2", "title": "Flow 3.1: Guest → Registration", "done": true },
        { "id": "26.3", "title": "Flow 3.2: Parent Search → Book", "done": true },
        { "id": "26.4", "title": "Flow 3.3: Parent Manage Bookings", "done": true },
        { "id": "26.5", "title": "Flow 3.4: Owner Onboarding", "done": true },
        { "id": "26.6", "title": "Flow 3.5: Owner Handle Bookings", "done": true },
        { "id": "26.7", "title": "Flow 3.6: Admin Moderation", "done": true },
        { "id": "26.8", "title": "Flow 3.7: Admin Verification", "done": true },
        { "id": "26.9", "title": "Auth Guards tests", "done": true },
        { "id": "26.10", "title": "Empty States tests", "done": true }
      ],
      "acceptanceCriteria": [
        "All 7 User Flows covered with E2E tests",
        "Auth guards tested for all protected routes",
        "Empty states tested for all pages",
        "Tests follow sitemap-v2.md structure"
      ],
      "affectedFiles": [
        "e2e/fixtures/auth.ts",
        "e2e/flows/*.spec.ts",
        "e2e/guards/auth-guards.spec.ts",
        "e2e/error-states/empty-states.spec.ts"
      ],
      "notes": [
        "2026-01-31: Created 10 test files based on sitemap-v2.md"
      ],
      "completedAt": "2026-01-31T12:00:00Z",
      "createdAt": "2026-01-31T11:00:00Z",
      "updatedAt": "2026-01-31T12:00:00Z"
    },
    {
      "id": 27,
      "title": "Trusted Device for 2FA",
      "description": "Add 'Trust this device' feature to skip 2FA on recognized devices for 30 days",
      "status": "done",
      "priority": "medium",
      "complexity": 3,
      "phase": "4.2",
      "tags": ["security", "2fa", "ux"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [
        { "id": "27.1", "title": "Add TrustedDevice Prisma model", "done": true },
        { "id": "27.2", "title": "Create trusted device server actions", "done": true },
        { "id": "27.3", "title": "Add checkbox on verify-2fa page", "done": true },
        { "id": "27.4", "title": "Check trusted device in needs2FAVerification", "done": true },
        { "id": "27.5", "title": "UI for managing trusted devices in settings", "done": true },
        { "id": "27.6", "title": "Email notification on new device", "done": true }
      ],
      "acceptanceCriteria": [
        "User can check 'Trust this device' on 2FA verification",
        "Trusted device skips 2FA for 30 days",
        "IP change requires re-verification",
        "Max 5 trusted devices per user",
        "User can view and remove trusted devices in settings",
        "Email sent when new device is trusted"
      ],
      "affectedFiles": [
        "prisma/schema.prisma",
        "src/server/actions/security/trusted-devices.ts",
        "src/app/(auth)/login/verify-2fa/two-factor-verify-form.tsx",
        "src/server/actions/security/two-factor.ts",
        "src/components/settings/security/trusted-devices.tsx"
      ],
      "notes": [
        "2026-01-31: Completed all subtasks - Prisma model, server actions, 2FA form checkbox, needs2FAVerification check, settings UI, email notification"
      ],
      "completedAt": "2026-01-31T15:00:00Z",
      "createdAt": "2026-01-31T14:00:00Z",
      "updatedAt": "2026-01-31T15:00:00Z"
    },
    {
      "id": 28,
      "title": "Git Workflow: dev → main",
      "description": "Development workflow reminder: all new features develop in 'dev' branch, test on Vercel preview, then merge to 'main' for production. Google OAuth configured only for production domain.",
      "status": "note",
      "priority": "info",
      "complexity": 0,
      "phase": "workflow",
      "tags": ["git", "workflow", "process"],
      "blockedBy": [],
      "blocks": [],
      "subtasks": [],
      "acceptanceCriteria": [
        "New features start in dev branch",
        "Test on Vercel preview (kindergarten-git-dev-*.vercel.app)",
        "After testing, merge dev → main",
        "Main deploys to production (kindergarten-lime.vercel.app)"
      ],
      "affectedFiles": [],
      "notes": [
        "2026-01-31: OAuth only works on production domain, preview needs manual Google Console setup",
        "Vercel preview protection disabled for testing"
      ],
      "createdAt": "2026-01-31T16:00:00Z",
      "updatedAt": "2026-01-31T16:00:00Z"
    }
  ]
}
